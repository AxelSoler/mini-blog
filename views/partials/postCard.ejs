<div
  x-data="{ showEditModal: false, showDeleteModal: false }"
  class="bg-white shadow p-4 rounded flex justify-between"
>
  <div>
    <h2 class="text-xl font-bold"><%= post.title %></h2>
    <p class="text-sm text-gray-600">by <%= post.user.username %></p>
    <div 
      x-data="{ 
        expanded: false, 
        showButton: false,
        checkOverflow($el) {
          this.$nextTick(() => {
            const p = $el.querySelector('p');
            if (p.scrollHeight > p.clientHeight) {
              this.showButton = true;
            }
          });
        }
      }" 
      x-init="checkOverflow($el)"
      class="flex flex-col"
    >
      <p :class="expanded ? '' : 'line-clamp-3'">
        <%= post.content %>
      </p>

      <button
        x-show="!expanded && showButton"
        x-cloak
        @click="expanded = true"
        class="text-blue-600 hover:underline ml-auto"
      >
        Load more
      </button>

      <button
        x-show="expanded && showButton"
        x-cloak
        @click="expanded = false"
        class="text-blue-600 hover:underline ml-auto"
      >
        Show less
      </button>
    </div>

    <p class="text-sm text-gray-500"><%= post.createdAt.toLocaleString() %></p>
  </div>

  <% if (currentUser && currentUser.id === post.userId) { %>
    <div class="flex gap-2 items-start">
      <!-- Edit Button -->
      <button
        @click="showEditModal = true"
        class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded"
      >
        Edit
      </button>

      <!-- Delete Button -->
      <button
        @click="showDeleteModal = true"
        class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded"
      >
        Delete
      </button>
    </div>
  <% } %>

  <!-- Edit Modal -->
  <div
    x-show="showEditModal"
    x-transition
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 px-4"
  >
    <div class="bg-white p-6 rounded w-full max-w-96 relative">
      <h3 class="text-lg font-semibold mb-4">Edit Post</h3>
      <button
        @click="showEditModal = false"
        class="text-gray-500 hover:text-gray-700 text-4xl font-bold absolute top-2 right-4"
      >
        &times;
      </button>
      <form
        action="/edit/<%= post.id %>?_method=PUT"
        method="POST"
        class="space-y-2"
      >
        <input
          type="text"
          name="title"
          value="<%= post.title %>"
          class="border p-2 w-full"
          required
        />
        <textarea name="content" class="border p-2 w-full" required><%= post.content %></textarea>
        <div class="flex justify-end gap-2">
          <button
            type="button"
            @click="showEditModal = false"
            class="px-4 py-2 bg-gray-300 rounded"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Modal -->
  <div
    x-show="showDeleteModal"
    x-transition
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
  >
    <div class="bg-white p-6 rounded w-96 relative">
      <h3 class="text-lg font-semibold mb-4">Are you sure?</h3>
      <p class="mb-4">This action will permanently delete the post.</p>
      <button
        @click="showDeleteModal = false"
        class="text-gray-500 hover:text-gray-700 text-4xl font-bold absolute top-2 right-4"
      >
        &times;
      </button>
      <form
        action="/delete/<%= post.id %>?_method=DELETE"
        method="POST"
        class="flex justify-end gap-2"
      >
        <button
          type="button"
          @click="showDeleteModal = false"
          class="px-4 py-2 bg-gray-300 rounded"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-red-600 text-white rounded"
        >
          Delete
        </button>
      </form>
    </div>
  </div>
</div>

